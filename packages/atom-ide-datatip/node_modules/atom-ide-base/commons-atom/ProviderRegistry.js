"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProviderRegistry = void 0;
const atom_1 = require("atom");
class ProviderRegistry {
    constructor() {
        this.providers = [];
    }
    addProvider(provider) {
        const index = this.providers.findIndex((p) => provider.priority > p.priority);
        if (index === -1) {
            this.providers.push(provider);
        }
        else {
            this.providers.splice(index, 0, provider);
        }
        return new atom_1.Disposable(() => {
            this.removeProvider(provider);
        });
    }
    removeProvider(provider) {
        const index = this.providers.indexOf(provider);
        if (index !== -1) {
            this.providers.splice(index, 1);
        }
    }
    getProviderForEditor(editor) {
        const grammar = editor.getGrammar().scopeName;
        return this.findProvider(grammar);
    }
    getAllProvidersForEditor(editor) {
        const grammar = editor.getGrammar().scopeName;
        return this.findAllProviders(grammar);
    }
    findProvider(grammar) {
        for (const provider of this.findAllProviders(grammar)) {
            return provider;
        }
        return null;
    }
    *findAllProviders(grammar) {
        for (const provider of this.providers) {
            if (provider.grammarScopes == null || provider.grammarScopes.indexOf(grammar) !== -1) {
                yield provider;
            }
        }
    }
}
exports.ProviderRegistry = ProviderRegistry;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJvdmlkZXJSZWdpc3RyeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy1jb21tb25zLWF0b20vUHJvdmlkZXJSZWdpc3RyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwrQkFBNkM7QUFHN0MsTUFBYSxnQkFBZ0I7SUFHM0I7UUFDRSxJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQTtJQUNyQixDQUFDO0lBRUQsV0FBVyxDQUFDLFFBQWtCO1FBQzVCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUM3RSxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNoQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtTQUM5QjthQUFNO1lBQ0wsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQTtTQUMxQztRQUNELE9BQU8sSUFBSSxpQkFBVSxDQUFDLEdBQUcsRUFBRTtZQUN6QixJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQy9CLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELGNBQWMsQ0FBQyxRQUFrQjtRQUMvQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUM5QyxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNoQixJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUE7U0FDaEM7SUFDSCxDQUFDO0lBR0Qsb0JBQW9CLENBQUMsTUFBa0I7UUFDckMsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLFNBQVMsQ0FBQTtRQUM3QyxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUdELHdCQUF3QixDQUFDLE1BQWtCO1FBQ3pDLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUE7UUFDN0MsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDdkMsQ0FBQztJQUVELFlBQVksQ0FBQyxPQUFlO1FBQzFCLEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3JELE9BQU8sUUFBUSxDQUFBO1NBQ2hCO1FBQ0QsT0FBTyxJQUFJLENBQUE7SUFDYixDQUFDO0lBS0QsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFlO1FBQy9CLEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNyQyxJQUFJLFFBQVEsQ0FBQyxhQUFhLElBQUksSUFBSSxJQUFJLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO2dCQUNwRixNQUFNLFFBQVEsQ0FBQTthQUNmO1NBQ0Y7SUFDSCxDQUFDO0NBQ0Y7QUF2REQsNENBdURDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlzcG9zYWJsZSwgVGV4dEVkaXRvciB9IGZyb20gXCJhdG9tXCJcclxuaW1wb3J0IHsgUHJvdmlkZXIgYXMgUHJvdmlkZXJUeXBlcywgQnVzeVNpZ25hbFByb3ZpZGVyLCBGaW5kUmVmZXJlbmNlc1Byb3ZpZGVyIH0gZnJvbSBcIi4uL3R5cGVzLXBhY2thZ2VzL21haW4uZFwiXHJcblxyXG5leHBvcnQgY2xhc3MgUHJvdmlkZXJSZWdpc3RyeTxQcm92aWRlciBleHRlbmRzIEV4Y2x1ZGU8UHJvdmlkZXJUeXBlcywgQnVzeVNpZ25hbFByb3ZpZGVyIHwgRmluZFJlZmVyZW5jZXNQcm92aWRlcj4+IHtcclxuICBwcml2YXRlIHByb3ZpZGVyczogQXJyYXk8UHJvdmlkZXI+XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5wcm92aWRlcnMgPSBbXVxyXG4gIH1cclxuXHJcbiAgYWRkUHJvdmlkZXIocHJvdmlkZXI6IFByb3ZpZGVyKTogRGlzcG9zYWJsZSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucHJvdmlkZXJzLmZpbmRJbmRleCgocCkgPT4gcHJvdmlkZXIucHJpb3JpdHkgPiBwLnByaW9yaXR5KVxyXG4gICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICB0aGlzLnByb3ZpZGVycy5wdXNoKHByb3ZpZGVyKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wcm92aWRlcnMuc3BsaWNlKGluZGV4LCAwLCBwcm92aWRlcilcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMucmVtb3ZlUHJvdmlkZXIocHJvdmlkZXIpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcmVtb3ZlUHJvdmlkZXIocHJvdmlkZXI6IFByb3ZpZGVyKTogdm9pZCB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucHJvdmlkZXJzLmluZGV4T2YocHJvdmlkZXIpXHJcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgIHRoaXMucHJvdmlkZXJzLnNwbGljZShpbmRleCwgMSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFRPRE8gZGVwcmVjYXRlIHNpbmNlIHRoZXJlIGNhbiBiZSBOIHByb3ZpZGVycy5cclxuICBnZXRQcm92aWRlckZvckVkaXRvcihlZGl0b3I6IFRleHRFZGl0b3IpOiBQcm92aWRlciB8IG51bGwge1xyXG4gICAgY29uc3QgZ3JhbW1hciA9IGVkaXRvci5nZXRHcmFtbWFyKCkuc2NvcGVOYW1lXHJcbiAgICByZXR1cm4gdGhpcy5maW5kUHJvdmlkZXIoZ3JhbW1hcilcclxuICB9XHJcblxyXG4gIC8vIFRPRE8gY3JlYXRlIGFuIG9yZGVyaW5nIG9yIHByaW9yaXR5IGF3YXJlIHV0aWwgdG8gcHJlZmVyIGluc3RlYWQuXHJcbiAgZ2V0QWxsUHJvdmlkZXJzRm9yRWRpdG9yKGVkaXRvcjogVGV4dEVkaXRvcik6IEl0ZXJhYmxlPFByb3ZpZGVyPiB7XHJcbiAgICBjb25zdCBncmFtbWFyID0gZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWVcclxuICAgIHJldHVybiB0aGlzLmZpbmRBbGxQcm92aWRlcnMoZ3JhbW1hcilcclxuICB9XHJcblxyXG4gIGZpbmRQcm92aWRlcihncmFtbWFyOiBzdHJpbmcpOiBQcm92aWRlciB8IG51bGwge1xyXG4gICAgZm9yIChjb25zdCBwcm92aWRlciBvZiB0aGlzLmZpbmRBbGxQcm92aWRlcnMoZ3JhbW1hcikpIHtcclxuICAgICAgcmV0dXJuIHByb3ZpZGVyXHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSXRlcmF0ZXMgb3ZlciBhbGwgcHJvdmlkZXJzIG1hdGNoaW5nIHRoZSBncmFtbWFyLCBpbiBwcmlvcml0eSBvcmRlci5cclxuICAgKi9cclxuICAqZmluZEFsbFByb3ZpZGVycyhncmFtbWFyOiBzdHJpbmcpOiBJdGVyYWJsZTxQcm92aWRlcj4ge1xyXG4gICAgZm9yIChjb25zdCBwcm92aWRlciBvZiB0aGlzLnByb3ZpZGVycykge1xyXG4gICAgICBpZiAocHJvdmlkZXIuZ3JhbW1hclNjb3BlcyA9PSBudWxsIHx8IHByb3ZpZGVyLmdyYW1tYXJTY29wZXMuaW5kZXhPZihncmFtbWFyKSAhPT0gLTEpIHtcclxuICAgICAgICB5aWVsZCBwcm92aWRlclxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==